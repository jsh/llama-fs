#!/bin/bash -eu
set -o pipefail

# this script is intended to succeed
# and to be idempotent

die() {
    # print error message and die
    echo "$*" || exit -1
}

is_key_set() {
    # README.md contains list of required API keys
    # and how to get values to set them to.
    grep -q "$1" .env || die "Set '$1' in .env file. See README.md for instructions."
}

pyenv local 3                           # use latest built python3 
python3 -m venv .venv                   # create virtual environment
source .venv/bin/activate               # use it
python bin/minimum-version.py 3.10      # verify Python is new enough
pip install --upgrade pip               # upgrade to latest pip
pip install -r requirements.txt         # install requirements
[ -f .env ] || cp .env.example .env     # create .env unless it already exists

# check that required API keys are set
is_key_set GROQ_API_KEY
is_key_set AGENTOPS_API_KEY
